<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Poligonos Multiples en un Mapa</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js'></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiMzB2aXRpbiIsImEiOiJjbDV0cnM2Z2EwNXBoM2RxNTdyMm95eTI0In0.calIeuPLdeQGzMZJJS8J6Q';
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v11',
            center: [-79.5644, 8.9592],
            zoom: 14
        });

        const p_balboa_inside = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "properties": {
                        "title": "Puerto Balboa",
                        "description": "El área del Puerto Balboa",
                        "color": "#3092D5"
                    },
                    "geometry": {
                        "coordinates": [
                            [
                                [-79.57071771782958, 8.964478939011485],
                                [-79.56402976170811, 8.956847093584443],
                                [-79.5677240011122, 8.952937714377896],
                                [-79.56738206734907, 8.95263239540644],
                                [-79.566857662979, 8.95318285502492],
                                [-79.56663266860346, 8.952951996491166],
                                [-79.56662151102445, 8.952778428299723],
                                [-79.56698302619573, 8.952398190284057],
                                [-79.56690133879181, 8.952322593626661],
                                [-79.5664459115883, 8.952808172289792],
                                [-79.56634605867387, 8.952725836622093],
                                [-79.5668043076374, 8.952236735669729],
                                [-79.5669845636039, 8.9520064396293],
                                [-79.56689471697861, 8.9519371266138],
                                [-79.56605817196649, 8.952774328423885],
                                [-79.56590160614505, 8.952749430309993],
                                [-79.56584822837708, 8.952614318658362],
                                [-79.56668472864358, 8.951739110214476],
                                [-79.56662998510949, 8.951698377917097],
                                [-79.56673014269765, 8.95157873021536],
                                [-79.56665485602952, 8.951521038628456],
                                [-79.56577503876997, 8.952490069675974],
                                [-79.56571381313559, 8.952433790117425],
                                [-79.56391152891936, 8.954388167564645],
                                [-79.563578318045, 8.954528439675002],
                                [-79.56350804846063, 8.95433052461155],
                                [-79.56546861846354, 8.952219182323617],
                                [-79.56520183756871, 8.952005472683908],
                                [-79.56718025935619, 8.949864989780849],
                                [-79.56697644286436, 8.947777350231178],
                                [-79.56681160130357, 8.9477982214556],
                                [-79.56671277159771, 8.947588595490728],
                                [-79.56658164371497, 8.947535598571108],
                                [-79.56653523466952, 8.947615907073484],
                                [-79.56622657058514, 8.947753304908659],
                                [-79.56599307673626, 8.947792019331459],
                                [-79.56544931481963, 8.947784065612538],
                                [-79.56532023422159, 8.947724560217253],
                                [-79.56489685180013, 8.947845214986458],
                                [-79.56492867395767, 8.948399417301275],
                                [-79.56544992505233, 8.948920408393946],
                                [-79.56535618639784, 8.949581483831452],
                                [-79.56496819341956, 8.950267033368391],
                                [-79.56436329112029, 8.951122631791904],
                                [-79.56308140290757, 8.954580652006996],
                                [-79.56062312132559, 8.957224377102833],
                                [-79.56102390569473, 8.958010651027791],
                                [-79.56110194021744, 8.958549142255634],
                                [-79.56186398850002, 8.959321881418532],
                                [-79.56191548376307, 8.959607731994566],
                                [-79.5623345925315, 8.959914982017636],
                                [-79.56337015304679, 8.96111620548352],
                                [-79.563278787758, 8.96156816643996],
                                [-79.5663431857662, 8.964922484049794],
                                [-79.56889280433988, 8.964992247999646],
                                [-79.57000690828592, 8.964858627278716],
                                [-79.57045807625245, 8.964706285305567],
                                [-79.57071771782958, 8.964478939011485]
                            ]
                        ],
                        "type": "Polygon"
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "Warehouse One",
                        "description": "El almacen 1 dentro del área del Puerto Balboa",
                        "height": 25,
                        "color": "#1A2DCF"
                    },
                    "geometry": {
                        "coordinates": [
                            [
                                [-79.56981697947393, 8.964254372547188],
                                [-79.56834405376595, 8.962575597495032],
                                [-79.56645278229551, 8.964254372547188],
                                [-79.56687984359522, 8.9646934355126],
                                [-79.56958165998185, 8.96448681771244],
                                [-79.56981697947393, 8.964254372547188]
                            ]
                        ],
                        "type": "Polygon"
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "title": "Warehouse Two",
                        "description": "El almacen 2 dentro del área del Puerto Balboa",
                        "height": 25,
                        "color": "#1A2DCF"
                    },
                    "geometry": {
                        "coordinates": [
                            [
                                [-79.56629590263448, 8.964133845365865],
                                [-79.56497114105089, 8.962696125193347],
                                [-79.56687984359522, 8.960922642171525],
                                [-79.56823946732547, 8.962437851505342],
                                [-79.56629590263448, 8.964133845365865]
                            ]
                        ],
                        "type": "Polygon"
                    }
                }
            ]
        }
        map.on('load', () => {
            map.addSource('p_balboa_inside', {
                'type': 'geojson',
                'data': p_balboa_inside
            });

            map.addLayer({
                'id': 'p_balboa_inside',
                'type': 'fill',
                'source': 'p_balboa_inside',
                'paint': {
                    'fill-color': ['get', 'color'],
                    'fill-opacity': 0.4
                }
            });

            map.addLayer({
                'id': 'warehouse_one',
                'type': 'fill-extrusion',
                'source': 'p_balboa_inside',
                'paint': {
                    'fill-extrusion-color': ['get', 'color'],
                    'fill-extrusion-opacity': 0.4,
                    'fill-extrusion-height': ['get', 'height'],
                }
            });

            map.addLayer({
                'id': 'warehouse_two',
                'type': 'fill-extrusion',
                'source': 'p_balboa_inside',
                'paint': {
                    'fill-extrusion-color': ['get', 'color'],
                    'fill-extrusion-opacity': 0.4,
                    'fill-extrusion-height': ['get', 'height'],
                }
            });

            map.addLayer({
                'id': 'outline',
                'type': 'line',
                'source': 'p_balboa_inside',
                'layout': {},
                'paint': {
                    'line-color': '#034289',
                    'line-width': 1
                }
            });

            map.on('click', 'p_balboa_inside', (e) => {
                const features = map.queryRenderedFeatures(e.point, { layers: ['p_balboa_inside'] });

                if (!features.length) {
                    return;
                }
                const feature = features[0];
                const coordinates = feature.geometry.coordinates[0];
                const popup = new mapboxgl.Popup()
                    .setLngLat(e.lngLat)
                    .setHTML(`
                        <h3>${feature.properties.title}</h3>
                        <p>${feature.properties.description}</p>
                    `)
                    .addTo(map);
            });
            
            // Funciones del cursor cuando entra y sale del rango del poligono
            map.on('mouseenter', 'p_balboa_inside', () => {
                map.getCanvas().style.cursor = 'pointer';
            });

            map.on('mouseleave', 'p_balboa_inside', () => {
                map.getCanvas().style.cursor = '';
            });

            // const layers = ['warehouse_one', 'warehouse_two'];
            // layers.forEach( layerId => {
            //     const features = map.queryRenderedFeatures({layers: [layerId]});
            //     if (features.length > 0){
            //         const layerData = features[0].properties;
            //     }

            //     const centerPoint = turf.center(features);
            //     const marker = new mapboxgl.Marker()
            //         .setLngLat(centerPoint.geometry.coordinates)
            //         .addTo(map);

            //     marker.getElement().addEventListener('click', () => {
            //         const popup = new mapboxgl.Popup()
            //            .setLngLat(centerPoint.geometry.coordinates)
            //            .setHTML(`<h3>${layerData.properties.title}</h3><p>${layerData.properties.description}</p>`)
            //            .addTo(map);
            //     });
            // });

        });
    </script>

</body>

</html>